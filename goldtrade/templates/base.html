{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Digital Gold Trade - Hifas Jewellery{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
/* âœ… NAVBAR */
.gold-navbar {
    background: linear-gradient(90deg, #f0c14b, #e2b027);
    color: #4a3809;
    font-weight: 600;
    padding: 10px 25px;
    border-bottom: 2px solid #d1aa22;
    box-shadow: 0 2px 10px rgba(193,157,43,0.25);
}

/* âœ… SIDEBAR */
.sidebar {
    height: 200vh;
    background: linear-gradient(180deg, #f8d879, #f0c14b);
    padding-top: 20px;
    min-width: 230px;
    box-shadow: 2px 0 8px rgba(0,0,0,0.15);
}

.sidebar a {
    display: flex;
    align-items: center;
    color: #3b2b09;
    font-weight: 600;
    padding: 12px 20px;
    text-decoration: none;
    border-left: 4px solid transparent;
    font-size: 15px;
    transition: 0.25s;
}
.sidebar a:hover, .sidebar a.active {
    background: linear-gradient(90deg, rgba(255,225,130,.9), rgba(224,186,35,1));
    color: white;
    border-left: 4px solid #c9a743;
    transform: translateX(4px);
}

/* âœ… PAGE BACKGROUND */
body {
    background: #0d1323;
    color: white;
}

/* âœ… GOLD GLOW */
#gold-ticker {
    animation: goldGlow 2s infinite alternate;
}
@keyframes goldGlow {
    0% { box-shadow: 0 0 4px rgba(255,215,0,0.4); }
    100% { box-shadow: 0 0 12px rgba(255,195,0,0.9); }
}

/* ğŸŒŸ Premium Animated Luxury Background */
body {
    background: radial-gradient(circle at top, #1a2337, #0b0f1c);
    color: white;
    overflow-x: hidden;
    position: relative;
}

/* âœ¨ Soft moving gold shine */
.gold-shimmer {
    position: fixed;
    top: 0;
    left: 0;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,215,0,0.08) 0%, rgba(0,0,0,0) 70%);
    animation: shimmerMove 18s infinite linear;
    z-index: -1;
}

@keyframes shimmerMove {
    0% { transform: translate(-20%, -20%) rotate(0deg); }
    50% { transform: translate(20%, 20%) rotate(180deg); }
    100% { transform: translate(-20%, -20%) rotate(360deg); }
}

/* Subtle floating particles ğŸ’« */
.gold-dots {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: -2;
    background:
        radial-gradient(circle 2px, rgba(255,215,0,.2) 40%, transparent 41%) 10% 20%,
        radial-gradient(circle 2px, rgba(255,215,0,.25) 40%, transparent 41%) 50% 80%,
        radial-gradient(circle 2px, rgba(255,215,0,.15) 40%, transparent 41%) 90% 30%,
        radial-gradient(circle 3px, rgba(255,215,0,.3) 40%, transparent 41%) 30% 50%;
    background-size: 150px 150px;
    animation: dotsFloat 10s infinite alternate ease-in-out;
}

@keyframes dotsFloat {
    0% { transform: translateY(0) }
    100% { transform: translateY(-13px) }
}

.wallet-switch-btn {
    background: #1a2333;
    border: 1px solid #d4af37;
    color: gold;
    font-size: 13px;
    font-weight: 600;
    padding: 5px 10px;
    border-radius: 6px;
    transition: .25s;
}

.wallet-switch-btn:hover {
    background: #2b3550;
    box-shadow: 0 0 8px rgba(212,175,55,0.6);
}
.badge {
    animation: fadeIn .3s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: scale(.8);}
    to { opacity: 1; transform: scale(1);}
}
<!-- âœ… SweetAlert Animation Styles -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">

<style>
.swal2-popup.gold-popup {
  border: 2px solid rgba(255, 215, 0, 0.4);
  box-shadow: 0 0 25px rgba(255, 215, 0, 0.25);
  border-radius: 16px;
}
.swal2-title {
  color: gold !important;
  text-shadow: 0 0 8px rgba(255, 215, 0, 0.8);
  font-family: 'Poppins', sans-serif;
}
.gold-btn {
  background: linear-gradient(90deg, #cfa842, #a87a1b);
  color: white !important;
  border-radius: 8px !important;
  font-weight: 600;
  box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  transition: all 0.3s ease-in-out;
}
.gold-btn:hover {
  background: linear-gradient(90deg, #ffce50, #b98a1d);
  transform: translateY(-2px);
  box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
}
.badge {
    font-size: 13px;
    padding: 4px 7px;
    animation: popBadge .4s ease;
}

@keyframes popBadge {
    from { transform: scale(0.6); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}
</style>

</style>
</head>

<body>
<div class="gold-shimmer"></div>
<div class="gold-dots"></div>

{% if user.is_authenticated %}
<div class="gold-navbar d-flex justify-content-between align-items-center">

    <div class="d-flex align-items-center">
        <img src="{% static 'images/hifas_logo.png' %}" 
            alt="Hifas Jewellery"
            style="height:42px; margin-right:10px; border-radius:5px;">
        <div class="fw-bold">
            Digital Gold Trade<br>
            <small style="font-size:13px; color:#4a3809;">Hifas Jewellery</small>
        </div>
    </div>

    <div class="d-flex align-items-center gap-3">

        <!-- âœ… Gold Price Ticker -->
        <div id="gold-ticker"
             class="px-3 py-1 fw-bold"
             style="background:#fff8d9; border-radius:6px; border:1px solid #d4b342; font-size:14px;">
            â³ Loading Gold Prices...
        </div>

<!-- Wallet Switch -->
<div class="dropdown">
  <button class="btn wallet-switch-btn dropdown-toggle d-flex align-items-center px-3 py-2"
          data-bs-toggle="dropdown"
          style="border-radius:8px;">

    {% if is_demo %}
      ğŸ§ª <span class="badge bg-warning text-dark ms-2">Demo Wallet</span>
    {% else %}
      ğŸ’³ <span class="badge bg-success ms-2">Real Wallet</span>
    {% endif %}
  </button>

  <ul class="dropdown-menu dropdown-menu-end">
      <li><a class="dropdown-item" href="{% url 'switch_wallet' 'real' %}?next={{ request.path }}">ğŸ’³ Real Wallet</a></li>
      <li><a class="dropdown-item" href="{% url 'switch_wallet' 'demo' %}?next={{ request.path }}">ğŸ§ª Demo Wallet</a></li>
  </ul>
</div>


<span class="gold-user ms-2">ğŸ‘‘ {{ request.user.username|title }}</span>
<a href="{% url 'logout' %}" class="ms-2 text-danger fw-bold">Logout</a>


  
    </div>

</div>
{% endif %}


<!-- âœ… LAYOUT -->
<div class="d-flex">

{% if user.is_authenticated %}
<div class="sidebar">
    <a href="{% url 'dashboard' %}" class="{% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">ğŸ  Dashboard</a>
    <a href="{% url 'buy_gold' %}" class="{% if request.resolver_match.url_name == 'buy_gold' %}active{% endif %}">ğŸ’° Buy Gold</a>
    <a href="{% url 'sell_gold' %}" class="{% if request.resolver_match.url_name == 'sell_gold' %}active{% endif %}">ğŸ’¸ Sell Gold</a>
    <a href="{% url 'transactions' %}" class="{% if request.resolver_match.url_name == 'transactions' %}active{% endif %}">ğŸ“œ Transactions</a>
    <a href="{% url 'add_money' %}" class="{% if request.resolver_match.url_name == 'add_money' %}active{% endif %}">ğŸ’µ Add Money</a>
    <a href="{% url 'my_deposits' %}" class="{% if request.resolver_match.url_name == 'my_deposits' %}active{% endif %}">ğŸ¦ My Deposits</a>
    <a href="{% url 'withdraw_money' %}" class="{% if request.resolver_match.url_name == 'withdraw_money' %}active{% endif %}">ğŸ’³ Withdraw Money</a>

{% if request.user.is_staff %}
    <a href="{% url 'update_rate' %}" class="{% if request.resolver_match.url_name == 'update_rate' %}active{% endif %}">
        âš™ï¸ Update Rate
    </a>

    <a href="{% url 'staff_deposits' %}" class="{% if request.resolver_match.url_name == 'staff_deposits' %}active{% endif %}">
        ğŸ›¡ï¸ Staff Deposits
        {% if pending_deposits_count > 0 %}
            <span class="badge bg-danger ms-2">{{ pending_deposits_count }}</span>
        {% endif %}
    </a>

    <a href="{% url 'staff_withdrawals' %}" class="{% if request.resolver_match.url_name == 'staff_withdrawals' %}active{% endif %}">
        ğŸ›ï¸ Staff Withdrawals
        {% if pending_withdrawals_count > 0 %}
            <span class="badge bg-warning text-dark ms-2">{{ pending_withdrawals_count }}</span>
        {% endif %}
    </a>
{% endif %}
</div>
{% endif %}

<div class="content flex-grow-1 p-4">
    {% block content %}{% endblock %}
</div>

</div>
{% if user.is_authenticated %}
<script>
function fetchGoldRates() {
    fetch("{% url 'refresh_rates' %}")
        .then(res => res.json())
        .then(data => {
            document.getElementById("gold-ticker").innerHTML =
                `ğŸŸ¡ Buy: <span style="color:green">${data.buy_rate.toLocaleString()}</span> | 
                 ğŸ”´ Sell: <span style="color:red">${data.sell_rate.toLocaleString()}</span>`;
        })
        .catch(() => {
            document.getElementById("gold-ticker").innerHTML = "âš ï¸ Price Update Error";
        });
}
fetchGoldRates();
setInterval(fetchGoldRates, 10000);
</script>
{% endif %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- âœ… SweetAlert2 (Animated Popups) -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
{% if messages %}
  {% for message in messages %}
    Swal.fire({
      title: `{% if message.tags == 'success' %}ğŸ‰ Success!{% else %}âš ï¸ Oops!{% endif %}`,
      html: `{{ message|escapejs }}`,
      icon: `{% if message.tags == 'success' %}success{% else %}error{% endif %}`,
      background: '#0d1221',
      color: 'gold',
      iconColor: `{% if message.tags == 'success' %}#ffd700{% else %}#ff5252{% endif %}`,
      confirmButtonText: 'OK',
      confirmButtonColor: '#d4af37',
      showClass: {
        popup: 'animate__animated animate__zoomIn animate__faster'
      },
      hideClass: {
        popup: 'animate__animated animate__fadeOut animate__faster'
      },
      customClass: {
        popup: 'gold-popup',
        confirmButton: 'gold-btn'
      },
    });
  {% endfor %}
{% endif %}
</script>

</body>
</html>
